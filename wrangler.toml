name = "sahajcloud"
compatibility_date = "2025-11-27"
main = ".open-next/worker.js"
compatibility_flags = ["nodejs_compat"]

# Sentry version tracking
[version_metadata]
binding = "CF_VERSION_METADATA"

# Workers.dev subdomain configuration
# Set to false to disable *.workers.dev routes (use custom domains instead)
workers_dev = false

# Preview URLs configuration
# Set to true to enable preview URLs for testing deployments
preview_urls = false

[observability]
enabled = true

[assets]
directory = ".open-next/assets"
binding = "ASSETS"

# D1 Database Binding
[[d1_databases]]
binding = "D1"
database_name = "sahajcloud"
database_id = "2ff069c0-a98b-4a6c-94eb-fe199f969c8b"
remote = true

# R2 Storage Binding
[[r2_buckets]]
binding = "R2"
bucket_name = "sahajcloud"
jurisdiction = "eu"

# Environment Variables (non-sensitive)
[vars]
NODE_ENV = "production"
SAHAJCLOUD_URL = "https://cloud.sydevelopers.com"
WEMEDITATE_WEB_URL = "https://wemeditate.com"
SAHAJATLAS_URL = "https://atlas.sydevelopers.com"
PUBLIC_ASSETS_URL = "assets.sydevelopers.com"

# Cloudflare Services Configuration
# Account-level identifiers (public, non-sensitive)
CLOUDFLARE_ACCOUNT_ID = ""  # Find in: Dashboard → Account Home → right sidebar
CLOUDFLARE_IMAGES_ACCOUNT_HASH = ""  # Find in: Images → Variants → delivery URL
CLOUDFLARE_STREAM_CUSTOMER_CODE = ""  # Find in: Stream → any video → player URL

# Sentry Configuration
# SENTRY_DSN should be set via: wrangler secret put SENTRY_DSN
# SENTRY_DSN = "https://your-dsn@sentry.io/project-id"

# Cloudflare API Tokens (sensitive - set via wrangler secret put)
# CLOUDFLARE_IMAGES_API_TOKEN - Token with "Account.Cloudflare Images:Edit" permission
# CLOUDFLARE_STREAM_API_TOKEN - Token with "Account.Stream:Edit" permission
# Set with:
#   wrangler secret put CLOUDFLARE_IMAGES_API_TOKEN
#   wrangler secret put CLOUDFLARE_STREAM_API_TOKEN

# Build Configuration
[build]
command = "WRANGLER_BUILD_CONDITIONS=\"\" WRANGLER_BUILD_PLATFORM=\"node\" pnpm exec opennextjs-cloudflare build"

# ========================================
# Development Environment
# ========================================
# Use this environment for local development
# Start with: PORT=4567 pnpm dev

[env.dev]
name = "sahajcloud-dev"
main = ".next/standalone/server.js"
workers_dev = true
preview_urls = true

# Sentry version tracking
[env.dev.version_metadata]
binding = "CF_VERSION_METADATA"

# D1 Database Binding (local development uses SQLite file)
[[env.dev.d1_databases]]
binding = "D1"
database_name = "sahajcloud-dev"
database_id = "local"

# R2 Storage Binding
[[env.dev.r2_buckets]]
binding = "R2"
bucket_name = "sahajcloud-dev"
jurisdiction = "eu"

# Environment Variables
[env.dev.vars]
NODE_ENV = "development"
SAHAJCLOUD_URL = "http://localhost:3000"
WEMEDITATE_WEB_URL = "http://localhost:5173"
SAHAJATLAS_URL = "http://localhost:5174"
PUBLIC_ASSETS_URL = "localhost"

# Cloudflare Services (optional in development - falls back to local storage if not set)
CLOUDFLARE_ACCOUNT_ID = ""
CLOUDFLARE_IMAGES_ACCOUNT_HASH = ""
CLOUDFLARE_STREAM_CUSTOMER_CODE = ""
